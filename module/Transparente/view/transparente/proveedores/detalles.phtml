<?php
/**
 * Vista detalle del proveedor
 *
 * @todo Se necesita la cita del artículo donde explica la ilegalidad de la relación familiar entre empleaods municipales y proveedores
 * @todo Hacer plugin del modal para bootstrap estilo plugins de JQuery
 */

/* @var $this Zend\View\Renderer\PhpRenderer */

$entidad = $this->vars('entity');
/* @var $entidad Transparente\Model\Entity\Proveedor */


function dl($term, $value) {
    if (!$value) $value = '--';
    return <<< HTML
<dt title="$term">$term</dt>
<dd>$value</dd>
HTML;

}
?>
<style>
.dl-horizontal dt { width: 200px; }
.dl-horizontal dd { margin-left: 210px;}
</style>
<script>
function openModal(id,title, body) {
    $('body').append('<div class="modal fade" id="' + id + '" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"> \
            <div class="modal-dialog"> \
              <div class="modal-content"> \
                <div class="modal-header"> \
                  <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button> \
                  <h4 class="modal-title" id="myModalLabel">' + title + '</h4> \
                </div> \
                <div class="modal-body">' + body + '</div> \
                <div class="modal-footer"> \
                  <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button> \
                </div> \
              </div> \
            </div> \
          </div>\
      ');
}
$(function() {
    openModal('empleadosMunicipalesModal', '¿Porqué queremos ver los empleados municipales?',
            'Un empleado municipal tiene poder de decición para contratar a los proveedores. Éste puede decidir darles \
            el trabajo a sus familiares con quienes ya ha acordado un precio para repartirse las ganancias. Esto es \
            ilegal<sup>se necesita link al artículo</sup>, pero es difícil de encontrar; es por eso que buscamos listar \
            los apellidos relacionados para encontrar estos actos de corrupción.');
});

</script>

<h1>Proveedor: <?=$entidad->getNombre()?></h1>

<div class="row">

    <div class="col-md-6">
        <dl class="dl-horizontal">
            <dt>nombre<dt>
            <dd>
                <a title="abrir en Guatecompras" href="http://guatecompras.gt/proveedores/consultaDetProvee.aspx?rqp=8&lprv=<?=$entidad->getId()?>">
                    <?=$entidad->getNombre()?>
                </a>
            </dd>
            <?=dl('última actualización por la SAT', $entidad->getUpdatedSat())?>

            <?php if (($nombresComerciales = $entidad->getNombresComerciales()) != false) : ?>
                <dt>nombres comerciales<dt>
                    <?php foreach($nombresComerciales as $nombreComercial) : /* @var $nombreComercial Transparente\Model\Entity\ProveedorNombreComercial */ ?>
                    <dd><?=$nombreComercial->getNombre()?></dd>
                    <?php endforeach ?>
            <?php endif ?>

            <dt>NIT<dt>
            <dd><?=$entidad->getNit()?></dd>

            <?php if (($domicilio = $entidad->getDomicilioFiscal()) != false) : /* @var $domicilio Transparente\Model\Entity\Domicilio */?>
            <dt>domicilio fiscal<dt>
            <dd>
                <address>
                    <?=$domicilio->getDireccion()?><br />
                    <a href="<?=$this->url()?>municipio/detalles/<?=$domicilio->getMunicipio()->getId()?>">
                        <?=$domicilio->getMunicipio()->getNombre()?></a>,
                    <?=$domicilio->getMunicipio()->getDepartamento()->getNombre()?><br />
                    <span class="glyphicon glyphicon-earphone"></span> tel: <?=$domicilio->getTelefonos()?><br />
                    <span class="glyphicon glyphicon-print"></span>    fax: <?=$domicilio->getFax()?>
                </address>
            </dd>
            <?php endif ?>

            <?php if (($domicilio = $entidad->getDomicilioComercial()) != false) : /* @var $domicilio Transparente\Model\Entity\Domicilio */?>
            <dt>domicilio comercial<dt>
            <dd>
                <address>
                    <?=$domicilio->getDireccion()?><br />
                    <a href="<?=$this->url()?>municipio/detalles/<?=$domicilio->getMunicipio()->getId()?>">
                        <?=$domicilio->getMunicipio()->getNombre()?></a>,
                    <?=$domicilio->getMunicipio()->getDepartamento()->getNombre()?><br />
                    <span class="glyphicon glyphicon-earphone"></span> tel: <?=$domicilio->getTelefonos()?><br />
                    <span class="glyphicon glyphicon-print"></span>    fax: <?=$domicilio->getFax()?>
                </address>
            </dd>
            <?php endif ?>

            <dt>e-mail<dt>
            <dd><?=$entidad->getEmail()?></dd>

            <dt>fecha de constitución<dt>
            <dd><?=$entidad->getConstFecha()?></dd>

            <dt>fecha inscripción provisional<dt>
            <dd><?=$entidad->getInscripcionProvisional()?></dd>

            <dt>fecha inscripción definitiva<dt>
            <dd><?=$entidad->getInscripcionDefinitiva()?></dd>

            <dt>fecha inscripción en la SAT<dt>
            <dd><?=$entidad->getInscripcionSat()?></dd>

            <dt>número de escritura de constitución<dt>
            <dd><?=$entidad->getConstNumEscritura()?></dd>

            <?=dl('principal actividad', $entidad->getPrincipalActividad())?>
            <?=dl('principal trabajo',   $entidad->getPrincipalTrabajo())?>

            <dt>status<dt>
            <dd><?=$entidad->getStatus($human = true)?></dd>

            <dt>tiene acceso al sistema<dt>
            <dd><?=$entidad->getTieneAccesoSistema($human = true)?></dd>

            <dt>tipo de organización<dt>
            <dd><?=$entidad->getTipoOrganización()?></dd>

            <dt>URL<dt>
            <dd><a href="http://<?=$entidad->getUrl()?>"><?=$entidad->getUrl()?></a></dd>
        </dl>
    </div>

    <div class="col-md-6">

        <?php if ($entidad->getRepresentantesLegales()) :?>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Representantes Legales</h3>
            </div>
            <div class="panel-body">
                <ul>
                    <?php foreach ($entidad->getRepresentantesLegales() as $repLegal) :?>
                    <li>
                        <a href="<?=$this->url()?>representante-legal/detalles/<?=$repLegal->getId()?>">
                            <?=$repLegal->getNombre()?>
                        </a>
                    </li>
                    <?php endforeach ?>
                </ul>
                <span class="small">última fecha de actualización: <?=$entidad->getRepLegalesUpdated()?></span>
            </div>
        </div>
        <?php endif ?>

        <?php if ($this->empleadosMunicipales) :?>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Empleados Municipales</h3>
            </div>
            <div class="panel-body">
                <p>
                    Listado de empleados municipales con apellidos simialres a algún representante legal del proveedor.
                    <button class="btn btn-info btn-xs" data-toggle="modal" data-target="#empleadosMunicipalesModal">
                        <span class="glyphicon glyphicon-question-sign"></span>
                    </button>
                </p>
                <ul>
                    <?php foreach ($this->empleadosMunicipales as  $empleadoMunicipal) : /* @var \Transparente\Model\Entity\EmpleadoMunicipal */?>
                    <li>
                        <?=$empleadoMunicipal->getNombre()?> <br />
                        <?=$empleadoMunicipal->getCargo()?> de
                        <a href="<?=$this->url()?>municipio/detalles/<?=$empleadoMunicipal->getMunicipio()->getId()?>">
                            <?=$empleadoMunicipal->getMunicipio()->getNombre()?></a>,
                        <?=$empleadoMunicipal->getMunicipio()->getDepartamento()->getNombre()?>.
                    </li>
                    <?php endforeach ?>
                </ul>
            </div>
        </div>
        <?php endif ?>
    </div>
</div>
